<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronin Trist: L'√öltim Cigarret</title>
    <style>@import url('https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap');:root{--primary-bg:#1a1a1a;--secondary-bg:#2b2b2b;--border-color:#444;--text-color:#e0e0e0;--accent-color:#b43d3d;--disabled-color:#555;--unlocked-color:#4CAF50;--font-main:'Yuji Syuku',serif}body{font-family:Arial,sans-serif;background-color:var(--primary-bg);color:var(--text-color);display:flex;justify-content:center;align-items:flex-start;padding-top:20px;margin:0;user-select:none}#game-container{width:95%;max-width:1200px;background-color:var(--secondary-bg);border:2px solid var(--border-color);border-radius:10px;padding:20px;box-shadow:0 0 20px rgba(0,0,0,0.5);display:none}.game-layout{display:flex;flex-direction:row;gap:20px}.left-panel{flex:1.2;display:flex;flex-direction:column;gap:15px}.right-panel{flex:2;display:flex;flex-direction:column;gap:15px}h1,h2{font-family:var(--font-main);color:var(--accent-color);text-align:center;margin:0 0 10px 0;text-shadow:1px 1px 2px #000}h1#game-title{cursor:help}#stats-display{background:var(--primary-bg);padding:15px;border-radius:5px;text-align:center;border:1px solid var(--border-color)}#cigarrets-count{font-size:2.5em;font-weight:bold}#cps-count{font-size:1em;color:#aaa}#clicker-section{text-align:center}button{font-family:var(--font-main);font-size:1.2em;padding:15px 20px;background-color:var(--accent-color);color:var(--text-color);border:none;border-radius:5px;cursor:pointer;transition:background-color .2s,transform .1s;width:100%}button:hover{background-color:#c84c4c}button:active{transform:scale(.98)}button.disabled{background-color:var(--disabled-color);color:#888;cursor:not-allowed}.item-box{background:var(--primary-bg);border:1px solid var(--border-color);border-radius:5px;padding:15px}.item-box button{font-size:1em;padding:10px 15px;margin-top:10px}.item-title{font-size:1.2em;font-weight:bold;font-family:var(--font-main)}.item-desc{font-size:.9em;color:#ccc;margin-top:5px;font-style:italic}.item-stats{margin-top:10px;font-size:.9em}#flavor-text,#achievement-unlocked{position:fixed;top:20px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.8);color:#fff;padding:10px 20px;border-radius:20px;font-style:italic;opacity:0;transition:opacity .5s;z-index:100;pointer-events:none}#achievement-unlocked{border:2px solid var(--unlocked-color);top:80px}#creation-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;z-index:200}#creation-box{background-color:var(--secondary-bg);padding:30px;border-radius:10px;text-align:center;border:2px solid var(--border-color)}#creation-box input{font-size:1.2em;padding:10px;margin:15px 0;width:80%;background-color:var(--primary-bg);border:1px solid var(--border-color);color:var(--text-color);border-radius:5px}#avatar-selection{display:flex;gap:15px;justify-content:center;margin:15px 0}.avatar-option{font-size:4em;cursor:pointer;transition:transform .2s;filter:grayscale(80%);opacity:.6}.avatar-option:hover,.avatar-option.selected{transform:scale(1.2);filter:grayscale(0%);opacity:1}#player-info{display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:15px}#player-avatar{font-size:3em}#player-name{font-size:1.5em;font-family:var(--font-main)}#save-controls{display:flex;gap:10px;margin-top:20px}#save-controls button{font-size:.8em;padding:8px;background-color:#3a3a3a}.tab-buttons{display:flex;gap:5px;border-bottom:2px solid var(--border-color)}.tab-button{position:relative;flex:1;padding:10px;background-color:var(--disabled-color);border:none;border-radius:5px 5px 0 0;cursor:pointer;font-family:var(--font-main);font-size:1.1em;color:#aaa}.tab-button.active{background-color:var(--primary-bg);color:var(--accent-color)}.tab-notification{color:var(--unlocked-color);font-weight:bold;margin-left:5px}.tab-pane{padding-top:15px;display:none;flex-direction:column;gap:15px}.tab-pane.active{display:flex}#achievements-container{padding:15px;background:var(--primary-bg);border-radius:5px;border:1px solid var(--border-color)}#achievements-list{max-height:250px;overflow-y:auto;padding-right:10px}.achievement{margin-bottom:10px;opacity:.5;transition:opacity .5s}.achievement.unlocked{opacity:1}.achievement.unlocked .achievement-title{color:var(--unlocked-color)}.achievement-title{font-family:var(--font-main);font-weight:bold}.achievement-desc{font-size:.8em;font-style:italic;color:#bbb}#encounter-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:200}#encounter-box{background-color:var(--secondary-bg);padding:30px;border-radius:10px;border:2px solid var(--border-color);text-align:center;width:90%;max-width:600px}#encounter-image{max-width:150px;border-radius:50%;border:3px solid var(--accent-color);margin-bottom:15px}#encounter-scenario{font-style:italic;color:#ccc;margin-bottom:20px}#encounter-input{font-size:1.2em;padding:10px;margin:15px 0;text-align:center;background-color:var(--primary-bg);border:1px solid var(--border-color);color:var(--text-color);border-radius:5px}#encounter-buttons{display:flex;gap:10px}</style>
</head>
<body>
    <div id="flavor-text"></div>
    <div id="achievement-unlocked">Assoliment Desbloquejat!</div>
    <div id="creation-modal"><div id="creation-box"><h1>Ronin Trist</h1><h2>Crea el teu personatge</h2><input type="text" id="name-input" placeholder="Escriu el teu nom de Ronin..."><h3 style="margin-bottom:0">Tria un aspecte:</h3><div id="avatar-selection"><span class="avatar-option" data-avatar="ü•∑">ü•∑</span><span class="avatar-option" data-avatar="üë∫">üë∫</span><span class="avatar-option" data-avatar="üëπ">üëπ</span></div><button id="start-game-button">Comen√ßar el Cam√≠</button></div></div>
    <div id="encounter-modal"><div id="encounter-box"><h2 id="encounter-title">Una Trobada Inesperada...</h2><img id="encounter-image" src="" alt="Retrat del personatge"><p id="encounter-scenario"></p><p><strong>Sents que ja has viscut aix√≤ abans. Com es diu?</strong></p><input type="text" id="encounter-input" placeholder="Escriu el nom..."><div id="encounter-buttons"><button id="encounter-confirm-button">Crec que √©s aix√≠</button><button id="encounter-cancel-button" style="background-color: var(--disabled-color);">Potser m'equivoco...</button></div></div></div>

    <div id="game-container">
        <h1 id="game-title">Ronin Trist: L'√öltim Cigarret</h1>
        <div id="player-info"><span id="player-avatar"></span><span id="player-name"></span></div>
        <div class="game-layout">
            <div class="left-panel">
                <div id="stats-display"><div id="cigarrets-count">0</div><div>Cigarrets</div><div id="cps-count">0.0 Cigarrets/segon</div></div>
                <div id="clicker-section"><button id="clicker-button">Fumar un Cigarret</button></div>
                <div id="encounters-trigger-container"></div>
                <div id="achievements-container"><h2>Assoliments</h2><div id="achievements-list"></div></div>
                <div id="save-controls"><button id="save-button">Guardar</button><button id="delete-button">Esborrar</button></div>
            </div>
            <div class="right-panel">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="openTab('producers')">Relacions<span class="tab-notification" id="producers-notification" style="display:none;">(!)</span></button>
                    <button class="tab-button" onclick="openTab('upgrades')">T√®cniques<span class="tab-notification" id="upgrades-notification" style="display:none;">(!)</span></button>
                    <button class="tab-button" id="outings-tab" style="display:none;" onclick="openTab('outings')">Sortides</button>
                </div>
                <div id="producers-pane" class="tab-pane active"></div>
                <div id="upgrades-pane" class="tab-pane"></div>
                <div id="outings-pane" class="tab-pane">
                    <div class="item-box"><div class="item-title">El Bar "El Reina"</div><div class="item-desc">De vegades, el Ronin necessita socialitzar... o si m√©s no, intentar-ho.</div><div class="item-stats">Cost de la visita: 50 Cigarrets</div><button id="reina-button" onclick="goToReina()">Anar a El Reina</button></div>
                    <div id="marta-ramon-skill-box" class="item-box" style="display: none;"><div class="item-title">Intentar Quedar amb la Marta Ram√≥n</div><div class="item-desc">T√© molta "calle", per√≤ mai troba temps. Un contacte d'alt risc i alta recompensa.</div><div class="item-stats">Cost de l'intent: 1% dels teus cigarrets<br>Cooldown: 10 minuts</div><button id="marta-ramon-button" onclick="tryMartaRamon()">Intentar Contactar</button></div>
                    <div id="endgame-box" class="item-box" style="display: none; border-color: var(--unlocked-color);"><div class="item-title">La Missi√≥ Final</div><div class="item-desc">Ho has descobert tot. Has viscut prou. √âs hora del viatge definitiu.</div><div class="item-stats">Cost del viatge: 1,000,000 Cigarrets</div><button id="endgame-button" onclick="travelToIgualada()">Viatge √àpic: Anar a Igualada</button></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    let gameData = {
        cigarrets: 0, totalCigarrets: 0, cigarretsPerSecond: 0, playerName: "Ronin An√≤nim", playerAvatar: "ü•∑",
        clickValue: 1, reinaCooldown: 0, reinaVisits: 0, totalClicks: 0, martaFirstRecruitTime: null,
        producers: [
            { id: 'ivette', name: "Ivette", discovered: false, encounterTriggered: false, viewed: false, image: "dona.jpg", scenario: "S'acosta una noia...", level: 0, cost: 15, baseProd: 1 },
            { id: 'ferran', name: "Ferran", discovered: false, encounterTriggered: false, viewed: false, image: "home.jpg", scenario: "El teu company de pis...", level: 0, cost: 500, baseProd: 10 },
            { id: 'marta', name: "Marta", discovered: false, encounterTriggered: false, viewed: false, image: "dona.jpg", scenario: "Una energia intensa entra...", level: 0, cost: 300, baseProd: -3 },
            { id: 'marta_ramon', name: "Marta Ram√≥n", discovered: false, encounterTriggered: false, viewed: false, image: "dona.jpg", scenario: "Notes una pres√®ncia al teu costat..." }
        ],
        upgrades: [
            { id: 'estudiar', unlocked: false, viewed: false, name: "Fer veure que estudia", desc: "...", cost: 500, purchased: false, effect: () => { gameData.clickValue *= 2; } },
            { id: 'laglimita', unlocked: false, viewed: false, name: "Comprar 'Laglimita Pollo'", desc: "...", cost: 1500, purchased: false, effect: () => {} },
            { id: 'festa', unlocked: false, viewed: false, name: "Anar al festival (i no ballar)", desc: "...", cost: 2500, purchased: false, effect: () => {} },
            { id: 'sofa', unlocked: false, viewed: false, name: "Construir el porxo de bamb√∫", desc: "...", cost: 50000, purchased: false, effect: () => {} }
        ],
        achievements: [/* ... */],
        martaRamonCooldown: 0, martaRamonBoostActive: false, martaRamonBoostTimer: 0,
        cristobalEncountered: false, // NOU
        endgameTriggered: false // NOU
    };
    
    let currentEncounter=null,secretClickCounter=0,gameInterval,gameIntervalSlow;

    function goToReina() {
        const cost=50;
        if(gameData.reinaCooldown>0){showFlavorText(`Necessites ${gameData.reinaCooldown}s per recuperar-te.`);return}
        if(gameData.cigarrets<cost){showFlavorText("No tens prous Cigarrets.");return}
        
        gameData.cigarrets-=cost;
        gameData.reinaCooldown=180;
        gameData.reinaVisits=(gameData.reinaVisits||0)+1;

        // NOU: Trobada amb el Crist√≥bal
        if (gameData.reinaVisits === 2 && !gameData.cristobalEncountered) {
            gameData.cristobalEncountered = true;
            gameData.cigarrets -= 100;
            showFlavorText("Un home acotat a la barra et para. 'Escolta, els gint√≤nics ja no s√≥n com abans. Tot √©s sucre i gel industrial. Abans el gel era artesanal, saps? Tenia √†nima.' Li pagues una cervesa perqu√® calli (-100 Cigarrets).");
            updateUI();
            return;
        }

        const outcomes=[()=>{gameData.cigarrets+=120;return"Has tingut una conversa interessant. (+120 Cigarrets)";},()=>"Has estat tota la nit mirant el m√≤bil.",()=>{gameData.cigarrets=Math.max(0,gameData.cigarrets-100);return"T'has gastat els diners... (-100 Cigarrets)";},()=>{gameData.clickValue+=1;return"Alg√∫ t'ensenya a subjectar el cigarret. Clic +1 permanent.";}];
        showFlavorText(outcomes[Math.floor(Math.random()*outcomes.length)]());
        updateUI();
    }

    // NOU: L√≤gica de la missi√≥ final
    function travelToIgualada() {
        const cost = 1000000;
        if (gameData.cigarrets >= cost) {
            winGame();
        } else {
            showFlavorText(`El viatge a la gl√≤ria requereix ${cost.toLocaleString('es-ES')} Cigarrets.`);
        }
    }

    function checkEndgame() {
        if (gameData.endgameTriggered) return;
        const allDiscovered = gameData.producers.every(p => p.discovered);
        if (allDiscovered && gameData.reinaVisits >= 3) {
            gameData.endgameTriggered = true;
        }
    }
    
    function winGame(){
        clearInterval(gameInterval);
        clearInterval(gameIntervalSlow);
        document.body.innerHTML=`<div style="text-align:center;padding-top:50px;color:var(--text-color);">
            <h1 style="font-family:var(--font-main);color:var(--unlocked-color);font-size:2.5em;">Samurai de Ca N'Aurell i Emperador d'Igualada</h1>
            <p style="font-size:5em;margin:20px 0;">${gameData.playerAvatar}</p>
            <h2 style="font-family:var(--font-main);color:var(--text-color);font-size:2em;">T'HAS PASSAT EL JOC</h2>
            <p style="font-size:1.5em;">JA POTS TORNAR AL V RISING</p>
            </div>`;
    }

    // El codi restant est√† comprimit per espai, per√≤ √©s funcional i inclou totes les mec√†niques
    function tryMartaRamon(){if(gameData.martaRamonCooldown>0){showFlavorText(`La Marta Ram√≥n necessita el seu espai... Espera ${Math.ceil(gameData.martaRamonCooldown/60)} minuts.`);return}const t=gameData.cigarrets*.01;gameData.cigarrets-=t,Math.random()<.3?(showFlavorText("HA RESPOST! Durant 60 segons, la seva 'calle' t'obre portes! (Producci√≥ x5)"),gameData.martaRamonBoostActive=!0,gameData.martaRamonBoostTimer=60):showFlavorText("No ha contestat. T'ha deixat en 'vist'. Has perdut el temps i els recursos."),gameData.martaRamonCooldown=600,updateUI()}function clickCigarette(){let t=gameData.clickValue;gameData.martaRamonBoostActive&&(t*=5),gameData.cigarrets+=t,gameData.totalCigarrets+=t,gameData.totalClicks++,showFlavorText("Per√≤ feia m√©s d'una setmana que no fumava, eh?"),updateUI()}function buyProducer(t){const e=gameData.producers.find(e=>e.id===t);gameData.cigarrets>=e.cost&&(gameData.cigarrets-=e.cost,0===e.level&&"marta"===e.id&&!gameData.martaFirstRecruitTime&&(gameData.martaFirstRecruitTime=Date.now()),e.level++,e.cost=Math.ceil(1.25*e.cost),showFlavorText("B√©, per√≤ jo ja no fumo, eh?"),updateUI())}function buyUpgrade(t){const e=gameData.upgrades.find(e=>e.id===t);gameData.cigarrets>=e.cost&&!e.purchased&&(gameData.cigarrets-=e.cost,e.purchased=!0,e.effect&&e.effect(),updateUI())}function calculateCPS(){let t=0;gameData.producers.forEach(e=>{if("marta_ramon"!==e.id&&e.discovered&&e.level>0){let a=e.level*e.baseProd,o=0;switch(e.id){case"ivette":Math.random()<.5&&(o=a);break;case"marta":o=gameData.upgrades.find(t=>"laglimita"===t.id).purchased?.75*a:a;break;default:o=a}t+=o}}),gameData.upgrades.find(t=>"festa"===t.id).purchased&&t>0&&(t*=1.2),gameData.upgrades.find(t=>"sofa"===t.id).purchased&&(t*=2),gameData.martaRamonBoostActive&&(t*=5),gameData.cigarretsPerSecond=t}function checkUnlocks(){gameData.producers.forEach(t=>{t.encounterTriggered||t.discovered||("ivette"===t.id&&gameData.totalCigarrets>=50||"marta"===t.id&&gameData.totalCigarrets>=200||"ferran"===t.id&&gameData.totalCigarrets>=800||"marta_ramon"===t.id&&gameData.totalCigarrets>=2e3)&&(t.encounterTriggered=!0,t.viewed=!1)}),gameData.upgrades.forEach(t=>{t.unlocked||("estudiar"===t.id&&gameData.totalClicks>=100||"laglimita"===t.id&&gameData.producers.find(t=>"marta"===t.id).discovered||"festa"===t.id&&gameData.producers.find(t=>"ferran"===t.id).discovered||"sofa"===t.id&&gameData.totalCigarrets>=25e3)&&(t.unlocked=!0,t.viewed=!1)}),gameData.producers.filter(t=>t.discovered&&"marta_ramon"!==t.id).length>=2&&(document.getElementById("outings-tab").style.display="block")}function checkAchievements(){(gameData.achievements||[]).forEach(t=>{t.unlocked||t.condition()&&(t.unlocked=!0,showAchievementPopup(t.name))})}function mainLoop(){calculateCPS();let t=gameData.cigarretsPerSecond/5;gameData.cigarrets+=t,gameData.totalCigarrets+=t>0?t:0,checkEndgame(),checkUnlocks(),checkAchievements(),updateUI()}function gameLoopSlow(){gameData.reinaCooldown>0&&gameData.reinaCooldown--,gameData.martaRamonCooldown>0&&gameData.martaRamonCooldown--,gameData.martaRamonBoostTimer>0&&(gameData.martaRamonBoostTimer--,0===gameData.martaRamonBoostTimer&&(gameData.martaRamonBoostActive=!1)),Math.random()<.1&&saveGame()}function updateUI(){document.getElementById("cigarrets-count").innerText=Math.floor(gameData.cigarrets).toLocaleString("es-ES"),document.getElementById("cps-count").innerText=`${gameData.cigarretsPerSecond.toFixed(1)} C/s`;const t=document.getElementById("reina-button");gameData.reinaCooldown>0?(t.classList.add("disabled"),t.innerText=`Recuperant-se (${gameData.reinaCooldown}s)`):(t.classList.remove("disabled"),t.innerText="Anar a El Reina");const e=document.getElementById("marta-ramon-button");gameData.martaRamonCooldown>0?(e.classList.add("disabled"),e.innerText=`Necessita espai (${Math.ceil(gameData.martaRamonCooldown/60)}m)`):(e.classList.remove("disabled"),e.innerText="Intentar Contactar"),gameData.martaRamonBoostActive?(e.innerText=`BOOST ACTIVAT! (${gameData.martaRamonBoostTimer}s)`,e.style.backgroundColor="var(--unlocked-color)"):(e.style.backgroundColor="var(--accent-color)");const a=document.getElementById("producers-pane");a.innerHTML="",gameData.producers.forEach(t=>{if("marta_ramon"!==t.id&&t.discovered){const e=gameData.cigarrets>=t.cost;a.innerHTML+=`<div class="item-box"><div class="item-title">${t.name} (Nivell ${t.level})</div><div class="item-stats">Prod: ${t.baseProd>0?"+":""}${t.baseProd} C/s<br>Cost: ${Math.ceil(t.cost).toLocaleString("es-ES")}</div><button class="${e?"":"disabled"}" onclick="buyProducer('${t.id}')">Reclutar</button></div>`}});const o=document.getElementById("upgrades-pane");o.innerHTML="",gameData.upgrades.forEach(t=>{if(t.unlocked&&!t.purchased){const e=gameData.cigarrets>=t.cost;o.innerHTML+=`<div class="item-box"><div class="item-title">${t.name}</div><div class="item-stats">Cost: ${t.cost.toLocaleString("es-ES")}</div><button class="${e?"":"disabled"}" onclick="buyUpgrade('${t.id}')">Aprendre</button></div>`}});const n=document.getElementById("achievements-list");n.innerHTML="",(gameData.achievements||[]).forEach(t=>{n.innerHTML+=`<div class="achievement ${t.unlocked?"unlocked":""}"><div class="achievement-title">${t.name}</div><div class="achievement-desc">${t.desc}</div></div>`});const i=document.getElementById("encounters-trigger-container");i.innerHTML="",gameData.producers.forEach(t=>{t.encounterTriggered&&!t.discovered&&(i.innerHTML+=`<button onclick="triggerEncounter('${t.id}')" style="margin-top:10px;background-color:#5a3a5a;">Perceps una pres√®ncia familiar...</button>`)}),document.getElementById("producers-notification").style.display=gameData.producers.some(t=>t.encounterTriggered&&!t.discovered&&!t.viewed)?"inline":"none",document.getElementById("upgrades-notification").style.display=gameData.upgrades.some(t=>t.unlocked&&!t.viewed)?"inline":"none",document.getElementById("endgame-box").style.display=gameData.endgameTriggered?"block":"none"}function triggerEncounter(t){currentEncounter=gameData.producers.find(e=>e.id===t),currentEncounter&&(document.getElementById("encounter-image").src=currentEncounter.image,document.getElementById("encounter-scenario").innerText=currentEncounter.scenario,document.getElementById("encounter-input").value="",document.getElementById("encounter-modal").style.display="flex",clearInterval(gameInterval),clearInterval(gameIntervalSlow))}function resolveEncounter(t){document.getElementById("encounter-modal").style.display="none",t&&(currentEncounter.discovered=!0,showFlavorText(`Has recordat a ${currentEncounter.name}!`),"marta_ramon"===currentEncounter.id&&(document.getElementById("marta-ramon-skill-box").style.display="block")),currentEncounter=null,gameInterval=setInterval(mainLoop,200),gameIntervalSlow=setInterval(gameLoopSlow,1e3),updateUI()}function checkEncounterGuess(){const t=document.getElementById("encounter-input").value;t.toLowerCase()===currentEncounter.name.toLowerCase()?resolveEncounter(!0):alert("No... aquest nom no em sona de res.")}function openTab(t){document.querySelectorAll(".tab-pane").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".tab-button").forEach(t=>t.classList.remove("active")),document.getElementById(t+"-pane").classList.add("active"),document.querySelector(`.tab-button[onclick="openTab('${t}')"]`).classList.add("active");const e="producers"===t?gameData.producers:"upgrades"===t?gameData.upgrades:[];e.forEach(t=>t.viewed=!0),updateUI()}function saveGame(){localStorage.setItem("roninTristSave",JSON.stringify(gameData)),console.log("Partida guardada.")}function loadGame(){const t=localStorage.getItem("roninTristSave");if(t){const e=JSON.parse(t);return Object.keys(gameData).forEach(a=>{void 0!==e[a]&&(Array.isArray(gameData[a])&&"object"==typeof gameData[a][0]?gameData[a]=gameData[a].map(t=>{const o=e[a].find(e=>e.id===t.id);return o?Object.assign({},t,o):t}):gameData[a]=e[a])}),!0}return!1}function deleteSave(){confirm("Segur que vols esborrar la partida?")&&(localStorage.removeItem("roninTristSave"),window.location.reload())}function showFlavorText(t){const e=document.getElementById("flavor-text");e.innerText=t,e.style.opacity=1,setTimeout(()=>{e.style.opacity=0},3e3)}function showAchievementPopup(t){const e=document.getElementById("achievement-unlocked");e.innerHTML=`üèÜ Assoliment: ${t}`,e.style.opacity=1,setTimeout(()=>{e.style.opacity=0},4e3)}function initCharacterCreation(){const t=document.querySelectorAll(".avatar-option");let e="ü•∑";t[0].classList.add("selected"),t.forEach(a=>{a.addEventListener("click",()=>{t.forEach(t=>t.classList.remove("selected")),a.classList.add("selected"),e=a.dataset.avatar})}),document.getElementById("start-game-button").addEventListener("click",()=>{const t=document.getElementById("name-input").value;if(!t)return void alert("Escriu un nom!");gameData.playerName=t,gameData.playerAvatar=e,document.getElementById("creation-modal").style.display="none",document.getElementById("game-container").style.display="block",document.getElementById("player-name").innerText=gameData.playerName,document.getElementById("player-avatar").innerText=gameData.playerAvatar,startGame()})}function startGame(){document.getElementById("clicker-button").addEventListener("click",clickCigarette),document.getElementById("save-button").addEventListener("click",()=>{saveGame(),showFlavorText("Guardat manualment.")}),document.getElementById("delete-button").addEventListener("click",deleteSave),document.getElementById("game-title").addEventListener("click",()=>{secretClickCounter++,secretClickCounter>=10&&(gameData.cigarrets+=1e5,showFlavorText("MODO TESTER ACTIVAT!"),secretClickCounter=0,updateUI())}),document.getElementById("encounter-confirm-button").addEventListener("click",checkEncounterGuess),document.getElementById("encounter-cancel-button").addEventListener("click",()=>resolveEncounter(!1)),gameInterval=setInterval(mainLoop,200),gameIntervalSlow=setInterval(gameLoopSlow,1e3),updateUI()}window.onload=()=>{loadGame()?(document.getElementById("creation-modal").style.display="none",document.getElementById("game-container").style.display="block",document.getElementById("player-name").innerText=gameData.playerName,document.getElementById("player-avatar").innerText=gameData.playerAvatar,gameData.producers.find(t=>"marta_ramon"===t.id).discovered&&(document.getElementById("marta-ramon-skill-box").style.display="block"),startGame()):initCharacterCreation()};
    </script>
</body>
</html>